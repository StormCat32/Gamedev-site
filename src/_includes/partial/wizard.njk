<div id="wizard">
	<svg viewBox="0 -20 64 150" xmlns="http://www.w3.org/2000/svg">
		<line id="wiz-legL" x1="12" y1="76" x2="12" y2="150" style="stroke:black;stroke-width:4" />
		<line id="wiz-legR" x1="52" y1="76" x2="52" y2="150" style="stroke:black;stroke-width:4" />
		<ellipse id="wiz-body" rx="32" ry="24" cx="32" cy="76" style="fill:#eee;stroke:none;"/>
		<rect id="wiz-eyeL" width="8" height="8" x="16" y="76" rx="3" ry="3" fill="black" />
		<rect id="wiz-eyeR" width="8" height="8" x="48" y="76" rx="3" ry="3" fill="black" />
		<rect id="wiz-eye-base" width="8" height="8" x="26" y="72" rx="3" ry="3" fill="black" fill-opacity="0" />
		<polygon id="wiz-hat" points="32,-10 60,64 4,64" style="fill:red;" />
	</svg> 
</div>

<style>
	#wizard {
		position: fixed;
		right: 1em;
		bottom: 2em;
		height: 33%;
		width: auto;
		aspect-ratio: 64 / 150 !important;
		touch-action: none;
		filter: drop-shadow(-1em 0 #0004);
		pointer-events: none;
	}
</style>

<script defer>
	let eyeL = document.getElementById('wiz-eyeL');
	let eyeR = document.getElementById('wiz-eyeR');
	let eyeBase = document.getElementById('wiz-eye-base');
	function lookat(e) {
		let rect = eyeBase.getBoundingClientRect();
		let ang = Math.atan2(e.clientY-(rect.bottom-rect.top+rect.bottom),e.clientX-(rect.left-rect.right+rect.left))
		let mx = Math.cos(ang);
		let my = Math.sin(ang);
		let x = 26 + (mx * 6);
		let y = 72 + (my * 6);
		const spacing = 16;
		eyeL.setAttribute('x', x - spacing);
		eyeR.setAttribute('x', x + spacing);
		eyeL.setAttribute('y', y);
		eyeR.setAttribute('y', y);
	}
	document.body.addEventListener('pointermove', lookat);
	
	var wiz = document.getElementById('wizard');
	wiz.style.pointerEvents = 'initial';

	var css = document.createElement('style');
	css.textContent = `@keyframes squishyAnim {
	  0%,
	  100% {
		transform: scale(1);
		transform-origin: bottom;
	  }
	  25% {
			transform: scale(1.3, 0.8);
		}
	  75% {
		transform: scale(0.8, 1.3);
	  }
	}`;
	document.head.appendChild(css);

	wiz.onclick = (function() {
		var colours = [ 'red', 'blue', 'darkorchid', 'lime' ];
		var currentColour = $('#wizard svg #wiz-hat').style.fill;
		var nextColour;
		wiz.style.animation = 'none';

		do {
			nextColour = colours[Math.floor(Math.random() * colours.length) ];
		} while(nextColour == currentColour);

		$('#wizard svg #wiz-hat').style.fill = nextColour;

		setTimeout(function() {
			wiz.style.animation = 'squishyAnim 0.22s ease-out';
		}, 0);
	});
</script>